import random
import string
import os
import cherrypy
import genttf
import binascii


class PwnServer(object):
    @cherrypy.expose
    def index(self):
        return "Hello world!"

    @cherrypy.expose
    def part2_ttf(self, **params):
    	if 'part2.ttf' not in cherrypy.request.path_info:
    		cherrypy.response.status = 404
    		return ''
    	if 'a' in cherrypy.request.params.keys():
    		try:
    			variant = [ord(b) for b in binascii.unhexlify(cherrypy.request.params['a'])]
    			cherrypy.response.headers['Content-Type'] = 'font/ttf'
    			return genttf.genall(variant)
    		except Exception as e:
    			print e
    			cherrypy.response.status = 404
    			return ''
        cherrypy.response.status = 404
        return ''

    @cherrypy.expose
    def leak_ttf(self, **params):
    	if 'leak.ttf' not in cherrypy.request.path_info:
    		cherrypy.response.status = 404
    		return ''
    	if 'a' in cherrypy.request.params.keys():
    		try:
    			variant = [ord(b) for b in binascii.unhexlify(cherrypy.request.params['a'])]
    			cherrypy.response.headers['Content-Type'] = 'font/ttf'
    			return genttf.genall(variant, True)
    		except Exception as e:
    			print e
    			cherrypy.response.status = 404
    			return ''
        cherrypy.response.status = 404
        return ''

config = {
  '/' : {
    'tools.staticdir.on'    : True,
    'tools.staticdir.dir'   : os.getcwd(),
  }  
}

if __name__ == '__main__':
    cherrypy.quickstart(PwnServer(), '/', config)